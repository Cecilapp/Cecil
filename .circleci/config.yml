version: 2
jobs:
    build:
      docker:
        - image: circleci/php:7.1-cli
      steps:
        - checkout
        - run:
            name: Switch timezone to Paris
            command: sudo cp /usr/share/zoneinfo/Europe/Paris /etc/localtime
        - run:
            name: Install Gettext
            command: sudo docker-php-ext-install gettext
        - run:
            name: Install GD
            command: sudo apt-get install -y libpng-dev && sudo docker-php-ext-install gd
        - run:
            name: Composer
            command: |
              sudo composer self-update
              composer install --no-interaction
        - run:
            name: PHPUnit
            command: |
              mkdir -p ~/phpunit
              vendor/bin/phpunit --log-junit ~/phpunit/junit.xml
            when: always
        - store_test_results:
            path: ~/phpunit
        - store_artifacts:
            path: ~/phpunit
